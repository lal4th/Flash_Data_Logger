# Flash Data Logger v0.7 Development Plan

## 🎯 **Project Overview**

**Version**: v0.7  
**Focus**: Multi-Channel Support & Math Channel Functionality  
**Target**: Advanced data acquisition with real-time mathematical analysis  

## 📋 **Development Phases**

### **Phase 1: Multi-Channel Foundation (Weeks 1-3)**

#### **Week 1: Core Architecture Updates**
- **Update PicoDirectSource** (`app/acquisition/pico_direct.py`)
  - Extend to support dual-channel acquisition
  - Implement simultaneous Channel A and B sampling
  - Add channel-specific configuration methods
  - Update voltage conversion for both channels

- **Update StreamingController** (`app/core/streaming_controller.py`)
  - Extend data structures for dual-channel data
  - Update acquisition loop for parallel channel sampling
  - Modify processing pipeline for multiple data streams
  - Update CSV writer for multi-channel format

#### **Week 2: UI Foundation**
- **Update MainWindow** (`app/ui/main_window.py`)
  - Implement tabbed interface for multiple plots
  - Create separate plot widgets for Channel A and Channel B
  - Add channel-specific control panels
  - Update status display for multi-channel information

- **Create Multi-Channel Plot Widget**
  - New class: `MultiChannelPlotWidget`
  - Support for independent plot windows
  - Synchronized time axes across channels
  - Individual Y-axis controls per channel

#### **Week 3: Data Integration**
- **Update CSV Writer** (`app/storage/csv_writer.py`)
  - Extend CSV format: `timestamp, Channel_A, Channel_B`
  - Add header information for channel settings
  - Implement multi-channel batch writing
  - Add data validation for synchronized timestamps

- **Testing & Validation**
  - Test dual-channel acquisition
  - Validate CSV output format
  - Performance testing for dual-channel streaming
  - UI responsiveness testing

### **Phase 2: Math Channel Engine (Weeks 4-6)**

#### **Week 4: Formula Parser & Evaluator**
- **Create Math Engine** (`app/processing/math_engine.py`)
  - Formula parsing and validation
  - Variable substitution (A, B)
  - Basic math operations (+, -, *, /, ^)
  - Error handling for invalid formulas

- **Create Formula Validator**
  - Syntax checking
  - Variable validation
  - Function validation
  - Error reporting with helpful messages

#### **Week 5: Advanced Math Functions**
- **Extend Math Engine**
  - Trigonometric functions: sin, cos, tan, asin, acos, atan
  - Logarithmic functions: log, ln, exp
  - Statistical functions: avg, min, max, std
  - Conditional logic: if-then-else

- **Performance Optimization**
  - Formula compilation for real-time evaluation
  - Calculation caching for complex expressions
  - Memory management for math channel buffers

#### **Week 6: Math Channel Integration**
- **Update StreamingController**
  - Integrate math engine into processing pipeline
  - Add math channel data structures
  - Implement real-time formula evaluation
  - Update CSV writer for math channels

- **Testing & Validation**
  - Test various math formulas
  - Validate calculation accuracy
  - Performance testing for real-time evaluation
  - Error handling testing

### **Phase 3: Enhanced UI & User Experience (Weeks 7-8)**

#### **Week 7: Math Channel UI**
- **Formula Input Interface**
  - Excel-style calculator bar
  - Syntax highlighting
  - Auto-completion for functions
  - Formula validation feedback

- **Math Channel Management**
  - Add/remove math channels (up to 6)
  - Formula editor with syntax validation
  - Drag-and-drop channel reordering
  - Enable/disable individual math channels

#### **Week 8: Advanced UI Features**
- **Tabbed Plot Interface**
  - Separate tabs for Channel A, Channel B, Math Channels
  - Individual plot controls per tab
  - Synchronized time navigation
  - Independent Y-axis scaling

- **Configuration Management**
  - Save/load multi-channel configurations
  - Profile management system
  - Quick setup templates
  - Export/import configurations

### **Phase 4: Testing & Polish (Weeks 9-10)**

#### **Week 9: Comprehensive Testing**
- **Functional Testing**
  - Multi-channel acquisition accuracy
  - Math channel calculation correctness
  - CSV export validation
  - UI responsiveness testing

- **Performance Testing**
  - High sample rate testing with dual channels
  - Math channel performance with complex formulas
  - Memory usage optimization
  - Long-term stability testing

#### **Week 10: Documentation & Final Polish**
- **Documentation Updates**
  - Update user manual for v0.7 features
  - Create math channel examples and tutorials
  - Update API documentation
  - Create migration guide from v0.6

- **Final Polish**
  - UI/UX improvements
  - Error message refinement
  - Performance optimizations
  - Bug fixes and stability improvements

## 🏗️ **Technical Architecture**

### **Updated File Structure**
```
Flash Data Logger/
├── app/
│   ├── acquisition/
│   │   ├── pico_direct.py          # ✅ Extended for dual-channel
│   │   ├── voltage_converter.py    # ✅ Existing - no changes needed
│   │   └── source.py               # ✅ Existing - no changes needed
│   ├── core/
│   │   ├── streaming_controller.py # ✅ Extended for multi-channel
│   │   └── controller.py           # ⚠️ Legacy - deprecated
│   ├── processing/
│   │   ├── pipeline.py             # ✅ Existing - no changes needed
│   │   └── math_engine.py          # 🆕 NEW: Math channel engine
│   ├── storage/
│   │   └── csv_writer.py           # ✅ Extended for multi-channel CSV
│   ├── ui/
│   │   ├── main_window.py          # ✅ Extended for multi-channel UI
│   │   └── multi_channel_widget.py # 🆕 NEW: Multi-channel plot widget
│   └── main.py                     # ✅ Existing - no changes needed
```

### **Data Flow Architecture**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Dual-Channel   │    │   Math Engine   │    │   Multi-Channel │
│   Acquisition   │───▶│   Processing    │───▶│   CSV Writer    │
│                 │    │                 │    │                 │
│ • Channel A     │    │ • Formula Eval  │    │ • Extended CSV  │
│ • Channel B     │    │ • Real-time Calc│    │ • All Channels  │
│ • Sync Timing   │    │ • Math_1-6      │    │ • Headers       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 ▼
                    ┌─────────────────┐
                    │   Tabbed UI     │
                    │   Interface     │
                    │                 │
                    │ • Channel A Tab │
                    │ • Channel B Tab │
                    │ • Math Tabs     │
                    └─────────────────┘
```

## 📊 **Implementation Details**

### **Multi-Channel Data Structures**
```python
@dataclass
class MultiChannelData:
    timestamp: float
    channel_a: float
    channel_b: float
    math_channels: List[float]  # [math_1, math_2, ..., math_6]

@dataclass
class ChannelConfig:
    enabled: bool
    voltage_range: int
    coupling: int
    offset: float
    name: str

@dataclass
class MathChannelConfig:
    enabled: bool
    formula: str
    compiled_formula: callable
    name: str
```

### **Math Engine Interface**
```python
class MathEngine:
    def validate_formula(self, formula: str) -> bool
    def compile_formula(self, formula: str) -> callable
    def evaluate_formula(self, compiled_formula: callable, 
                        channel_a: float, channel_b: float) -> float
    def get_supported_functions(self) -> List[str]
    def get_formula_help(self) -> str
```

### **Extended CSV Format**
```csv
# Flash Data Logger v0.7 - Multi-Channel Data
# Timestamp: 2025-01-XX XX:XX:XX
# Sample Rate: 1000 Hz
# Channel A: ±5V, DC, Offset: 0.000V
# Channel B: ±2V, DC, Offset: 0.000V
# Math_1: A+B
# Math_2: A-B
# Math_3: A*B
# Math_4: A/B
# Math_5: A^2
# Math_6: sqrt(A)
timestamp,Channel_A,Channel_B,Math_1,Math_2,Math_3,Math_4,Math_5,Math_6
0.000000,1.234567,2.345678,3.580245,-1.111111,2.901234,0.526316,1.524157,1.111111
0.001000,1.235678,2.346789,3.582467,-1.111111,2.904567,0.526543,1.526901,1.111235
...
```

## 🎯 **Success Criteria**

### **Functional Requirements**
- ✅ **Dual-channel acquisition**: Simultaneous Channel A and B sampling
- ✅ **Math channel support**: Up to 6 real-time calculated channels
- ✅ **Formula validation**: Syntax checking and error reporting
- ✅ **Extended CSV export**: All channels included in single file
- ✅ **Tabbed UI**: Separate plot windows for each channel type

### **Performance Requirements**
- ✅ **Real-time evaluation**: Math channels calculated within 10ms
- ✅ **No performance degradation**: Maintain 5000Hz sample rate capability
- ✅ **Memory efficiency**: Efficient buffering for multiple data streams
- ✅ **UI responsiveness**: Smooth plot updates at 10Hz rate

### **User Experience Requirements**
- ✅ **Intuitive interface**: Easy-to-use formula editor
- ✅ **Error handling**: Clear error messages for invalid formulas
- ✅ **Configuration management**: Save/load multi-channel setups
- ✅ **Documentation**: Comprehensive user guide and examples

## 🚀 **Deployment Strategy**

### **Development Environment**
- **Version Control**: Git branching strategy for v0.7 development
- **Testing**: Automated testing for math engine and multi-channel functionality
- **Documentation**: Real-time documentation updates during development

### **Release Strategy**
- **Beta Testing**: Internal testing with complex multi-channel scenarios
- **User Feedback**: Gather feedback on UI/UX and performance
- **Final Release**: Production-ready v0.7 with full documentation

### **Migration from v0.6**
- **Backward Compatibility**: v0.6 CSV files readable by v0.7
- **Configuration Migration**: Automatic upgrade of v0.6 settings
- **User Guide**: Step-by-step migration instructions

## 📈 **Expected Outcomes**

### **Technical Achievements**
- **Advanced Data Acquisition**: Professional-grade multi-channel capability
- **Real-time Analysis**: Mathematical analysis during data acquisition
- **Enhanced Productivity**: Simultaneous monitoring of multiple signals
- **Professional Features**: Excel-like formula capabilities for data analysis

### **User Benefits**
- **Increased Efficiency**: Monitor multiple signals simultaneously
- **Real-time Insights**: Mathematical analysis during data acquisition
- **Flexible Analysis**: Custom formulas for specific measurement needs
- **Professional Workflow**: Advanced features for engineering applications

---

**Development Timeline**: 10 weeks  
**Target Release**: Q2 2025  
**Status**: Ready for Development  
**Priority**: High - Core feature enhancement
